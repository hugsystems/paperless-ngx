<pngx-widget-frame
  *pngxIfPermissions="{ action: PermissionAction.View, type: PermissionType.Document }"
  [title]="savedView.name"
  [loading]="loading"
  [draggable]="savedView"
  >

  @if (documents.length) {
    <a class="btn-link text-decoration-none" header-buttons [routerLink]="[]" (click)="showAll()" i18n>Show all</a>
  }

  @if (documents.length && savedView.display_mode === DashboardViewMode.TABLE) {
    <table content class="table table-hover mb-0 mt-n2 align-middle">
      <thead>
        <tr>
          @for (column of savedView.document_display_fields; track column; let i = $index) {
            @if (visibleColumns.includes(column)) {
              <th
                scope="col"
                [ngClass]="{
                  'd-none d-md-table-cell': i > 1,
                  'w-25': column === DashboardViewTableColumn.CREATED || column === DashboardViewTableColumn.ADDED
                }">
                {{ getColumnTitle(column) }}
              </th>
            }
          }
        </tr>
      </thead>
      <tbody>
        @for (doc of documents; track doc.id) {
          <tr>
            @for (column of savedView.document_display_fields; track column; let i = $index) {
              @if (visibleColumns.includes(column)) {
                <td class="py-2 py-md-3 position-relative" [ngClass]="{ 'd-none d-md-table-cell': i > 1 }">
                  @switch (column) {
                    @case (DashboardViewTableColumn.ADDED) {
                      <a routerLink="/documents/{{doc.id}}" class="btn-link text-dark text-decoration-none py-2 py-md-3">{{doc.added | customDate}}</a>
                    }
                    @case (DashboardViewTableColumn.CREATED) {
                      <a routerLink="/documents/{{doc.id}}" class="btn-link text-dark text-decoration-none py-2 py-md-3">{{doc.created_date | customDate}}</a>
                    }
                    @case (DashboardViewTableColumn.TITLE) {
                      <a routerLink="/documents/{{doc.id}}" title="Edit" i18n-title class="btn-link text-dark text-decoration-none py-2 py-md-3">{{doc.title | documentTitle}}</a>
                    }
                    @case (DashboardViewTableColumn.CORRESPONDENT) {
                      @if (doc.correspondent) {
                        <a class="btn-link text-dark text-decoration-none" type="button" (click)="clickCorrespondent(doc.correspondent, $event)">{{(doc.correspondent$ | async)?.name}}</a>
                      }
                    }
                    @case (DashboardViewTableColumn.TAGS) {
                      @for (t of doc.tags$ | async; track t) {
                        <pngx-tag [tag]="t" class="ms-1" (click)="clickTag(t.id, $event)"></pngx-tag>
                      }
                    }
                    @case (DashboardViewTableColumn.DOCUMENT_TYPE) {
                      @if (doc.document_type) {
                        <a class="btn-link text-dark text-decoration-none" type="button" (click)="clickDocType(doc.document_type, $event)">{{(doc.document_type$ | async)?.name}}</a>
                      }
                    }
                    @case (DashboardViewTableColumn.STORAGE_PATH) {
                      @if (doc.storage_path) {
                        <a class="btn-link text-dark text-decoration-none" type="button" (click)="clickStoragePath(doc.storage_path, $event)">{{(doc.storage_path$ | async)?.name}}</a>
                      }
                    }
                  }
                  @if (column.startsWith(DashboardViewTableColumn.CUSTOM_FIELD)) {
                    @switch(getCustomFieldDataType(column)) {
                      @case (CustomFieldDataType.Monetary) {
                        {{ getMonetaryCustomFieldValue(doc, column)[0] | currency: getMonetaryCustomFieldValue(doc, column)[1] }}
                      }
                      @case (CustomFieldDataType.Date) {
                        {{ getCustomFieldValue(doc, column) | customDate }}
                      }
                      @case (CustomFieldDataType.Url) {
                        <a [href]="getCustomFieldValue(doc, column)" class="btn-link text-dark text-decoration-none" target="_blank">{{ getCustomFieldValue(doc, column) }}</a>
                      }
                      @case (CustomFieldDataType.DocumentLink) {
                        <div class="d-flex gap-1 flex-wrap">
                          @for (docId of getCustomFieldValue(doc, column); track docId) {
                            <a routerLink="/documents/{{docId}}" class="badge bg-dark text-primary" title="View" i18n-title>
                              <i-bs width="0.9em" height="0.9em" name="file-text"></i-bs>&nbsp;<span>{{ getDocumentTitle(docId) }}</span>
                            </a>
                          }
                        </div>
                      }
                      @default {
                        {{ getCustomFieldValue(doc, column) }}
                      }
                    }
                  }
                  @if (i === savedView.document_display_fields.length - 1) {
                    <div class="btn-group position-absolute top-50 end-0 translate-middle-y">
                      <a [href]="getPreviewUrl(doc)" title="View Preview" i18n-title target="_blank" class="btn px-4 btn-dark border-dark-subtle"
                        [ngbPopover]="previewContent" [popoverTitle]="doc.title | documentTitle"
                        autoClose="true" popoverClass="shadow popover-preview" container="body" (mouseenter)="mouseEnterPreviewButton(doc)" (mouseleave)="mouseLeavePreviewButton()" #popover="ngbPopover">
                        <i-bs width="0.8em" height="0.8em" name="eye"></i-bs>
                      </a>
                      <ng-template #previewContent>
                        <pngx-preview-popup [document]="doc" (mouseenter)="mouseEnterPreview()" (mouseleave)="mouseLeavePreview()"></pngx-preview-popup>
                      </ng-template>
                      <a [href]="getDownloadUrl(doc)" class="btn px-4 btn-dark border-dark-subtle" title="Download" i18n-title (click)="$event.stopPropagation()">
                        <i-bs width="0.8em" height="0.8em" name="download"></i-bs>
                      </a>
                    </div>
                  }
                </td>
              }
            }
          </tr>
        }
      </tbody>
    </table>
  } @else if (documents.length && savedView.display_mode === DashboardViewMode.SMALL_CARDS) {
    <div class="row row-cols-paperless-cards my-n2">
      @for (d of documents; track d.id) {
        <pngx-document-card-small class="p-0" (dblClickDocument)="openDocumentDetail(d)" [document]="d" (clickTag)="clickTag($event)" (clickCorrespondent)="clickCorrespondent($event)" (clickStoragePath)="clickStoragePath($event)" (clickDocumentType)="clickDocumentType($event)"></pngx-document-card-small>
      }
    </div>
  } @else {
    <p i18n class="text-center text-muted mb-0 fst-italic">No documents</p>
  }


</pngx-widget-frame>
